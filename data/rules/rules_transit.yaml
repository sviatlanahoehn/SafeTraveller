version: "2.0"
rules:

#--------- Explanation ------
# Entry regulations query picks a case based on details that apply to a user's case.
# Transit implies specific values for some of the slots (e.g. entry for <48h).
# There is no separate query for transit.
# Instead, based on the transit slot value other consitions are filled in.
#A query is made to retrieve the appropriate regulations.

#---------NEW TRANSIT-------

  - rule: query transit
    steps:
    - intent: query_transit
    - action: set_transit_form
    - active_loop: set_transit_form

  - rule: submit set_transit_form
    condition:
    - active_loop: set_transit_form
    steps:
    - action: set_transit_form
    - active_loop: null
#    - action: action_extract_countries
    - action: action_validate_countries
    wait_for_user_input: false

#------ TRANSIT BELGIUM -----
  - rule: transit through BE
    condition:
    - active_loop: stay_OR_transit_form
    - slot_was_set:
      - transit: true
      - country_to: Belgium
    steps:
    - action: stay_OR_transit_form
    - active_loop: null
    - action: plane_travel_form
    - active_loop: plane_travel_form
  - rule: BE submit plane_travel_form
    condition:
    - active_loop: plane_travel_form
    - slot_was_set:
      - country_to: Belgium
    steps:
    - action: plane_travel_form
    - active_loop: null
    - slot_was_set:
      - requested_slot: null
    - action: children_travel_form
    - active_loop: children_travel_form

#------- TRANSIT LUXEMBOURG --------
  - rule: transit through BE
    condition:
    - active_loop: stay_OR_transit_form
    - slot_was_set:
      - transit: true
    steps:
    - action: stay_OR_transit_form
    - active_loop: null
    - slot_was_set:
      - requested_slot: null
    - action: children_travel_form
    - active_loop: children_travel_form

#------- TRANSIT Netherlands --------
  - rule: transit through BE
    condition:
    - active_loop: stay_OR_transit_form
    - slot_was_set:
      - transit: true
      - country_to: Netherlands
    steps:
    - action: stay_OR_transit_form
    - active_loop: null
    - action: plane_travel_form
    - active_loop: plane_travel_form




# ===== Transit through Germany =====
#  - rule: activate transit through Germany form (from NL to LUX + by car)
#    condition:
#    - active_loop: plane_travel_form
#    - slot_was_set:
#      - country_from: Netherlands
#      - country_to: Luxembourg
#      - plane_travel: car
#    steps:
#    - action: plane_travel_form
#    - active_loop: null
#    - slot_was_set:
#      - requested_slot: null
#    - action: transit_BE_form
#    - active_loop: transit_BE_form
#  - rule: activate transit through Germany form (from NL to LUX + by coach)
#    condition:
#    - active_loop: plane_travel_form
#    - slot_was_set:
#      - country_from: Netherlands
#      - country_to: Luxembourg
#      - plane_travel: coach
#    steps:
#    - action: plane_travel_form
#    - active_loop: null
#    - slot_was_set:
#      - requested_slot: null
#    - action: transit_BE_form
#    - active_loop: transit_BE_form
#  - rule: activate transit through Germany form (from LUX to NL + worker)
#    condition:
#    - active_loop: NL_worker_form
#    - slot_was_set:
#      - country_from: Luxembourg
#      - country_to: Netherlands
#      - visit_purpose: work
#    steps:
#    - action: NL_worker_form
#    - active_loop: null
#    - slot_was_set:
#      - requested_slot: null
#    - action: transit_BE_form
#    - active_loop: transit_BE_form
#  - rule: activate transit through Germany form (from LUX to NL + by car)
#    condition:
#    - active_loop: plane_travel_form
#    - slot_was_set:
#      - country_from: Luxembourg
#      - country_to: Netherlands
#      - plane_travel: car
#    steps:
#    - action: plane_travel_form
#    - active_loop: null
#    - slot_was_set:
#      - requested_slot: null
#    - action: transit_BE_form
#    - active_loop: transit_BE_form
#  - rule: activate transit through Germany form (from LUX to NL + by coach)
#    condition:
#    - active_loop: plane_travel_form
#    - slot_was_set:
#      - country_from: Luxembourg
#      - country_to: Netherlands
#      - plane_travel: coach
#    steps:
#    - action: plane_travel_form
#    - active_loop: null
#    - slot_was_set:
#      - requested_slot: null
#    - action: transit_BE_form
#    - active_loop: transit_BE_form
