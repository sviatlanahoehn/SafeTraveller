version: "2.0"
rules:
#------ intent INFORM_COUNTRIES -------
  - rule: inform_countries query
    steps:
    - intent: inform_countries
    - action: action_validate_countries
    - action: regulations_type_form
    - active_loop: regulations_type_form
  - rule: inform_countries for ENTRY
    condition:
    - slot_was_set:
      - regulations_type: entry_regulations
    steps:
    - intent: inform_countries
    - action: action_validate_countries
    wait_for_user_input: false
  - rule: inform_countries for VACCINES
    condition:
    - slot_was_set:
      - regulations_type: vaccine_regulations
    steps:
    - intent: inform_countries
    - action: action_validate_countries
    - action: vaccine_regulations_form
    - active_loop: vaccine_regulations_form
  - rule: inform_countries for LOCAL
    condition:
    - slot_was_set:
      - regulations_type: local_regulations
    steps:
    - intent: inform_countries
    - action: local_regulations_form
    - active_loop: local_regulations_form
#--------BASIC-CONVERSATION-MANAGEMENT--------
  - rule: greet
    steps:
      - intent: greet
      - action: utter_greet
  - rule: goodbye
    steps:
      - intent: goodbye
      - action: utter_goodbye
  - rule: thank you
    steps:
      - intent: thank_you
      - action: utter_ur_welcome
  - rule: wellbeing check
    steps:
      - intent: wellbeing_check
      - action: utter_mood
  - rule: bot challenge
    steps:
      - intent: bot_challenge
      - action: utter_iamabot
  - rule: return
    steps:
    - intent: go_back
    - action: action_go_back
  - rule: going to main_menu
    steps:
    - intent: main_menu
    - action: action_reset_regulations_type
    - action: regulations_type_form
    - active_loop: regulations_type_form
#  - rule: inquiry about other countries
#    steps:
#      - intent: ask_other_countries
#      - action: utter_answer_for_other_countries
#  - rule: user asks to list the countries
#    steps:
#      - intent: ask_which_countries
#      - action: utter_list_the_countries
#  - rule: user asks functionality
#    steps:
#      - intent: what_can_u_do
#      - action: utter_explain_functionality
#  - rule: repeating
#    steps:
#      - intent: repeat_please
#      - action: action_repeat_last


# -------CONVERSATION BEGINNING--------
  - rule: greet at the beggining
    conversation_start: true
    steps:
      - intent: greet
      - action: utter_greet
      - action: utter_welcome_message
#      - action: action_utter_disclaimer
      - action: utter_prompt_begin
      - action: utter_type_restart
      #- action: regulations_type_form
      #- active_loop: regulations_type_form
  - rule: choose entry regulations type
    condition:
    - active_loop: regulations_type_form
    - slot_was_set:
      - regulations_type: entry_regulations
      - country_to: None
      - country_from: None
    steps:
    - action: regulations_type_form
    - active_loop: null
    - action: utter_ask_trip_details
  - rule: choose entry regulations type
    condition:
    - active_loop: regulations_type_form
    - slot_was_set:
      - regulations_type: entry_regulations
    steps:
    - action: regulations_type_form
    - active_loop: null
    - action: action_validate_countries
    wait_for_user_input: false

  - rule: validate countries
    steps:
    - intent: query_entry_regulations
    - action: set_regulations_type_form
    - active_loop: set_regulations_type_form
    - active_loop: null
    - action: action_validate_countries
    wait_for_user_input: false
  - rule: wrong country_to extracted
    condition:
    - slot_was_set:
      - country_to: None
    steps:
    - action: action_validate_countries
#    - action: utter_not_understood
    - action: country_form
    - active_loop: country_form
  - rule: wrong country_from extracted
    condition:
    - slot_was_set:
      - country_from: None
    steps:
    - action: action_validate_countries
#    - action: utter_not_understood
    - action: country_form
    - active_loop: country_form
  - rule: correct countries extracted
    condition:
    - slot_was_set:
      - regulations_type: entry_regulations
    steps:
    - action: action_validate_countries
    - action: country_form
    - active_loop: country_form
  - rule: submit country_form//activate confirm_country_form
    condition:
    - active_loop: country_form
    steps:
    - action: country_form
    - active_loop: null
    - action: action_check_area
    - action: confirm_country_form
    - active_loop: confirm_country_form
  - rule: correct the countries
    condition:
    - active_loop: confirm_country_form
    - slot_was_set:
      - correct_countries: false
    steps:
    - action: confirm_country_form
    - active_loop: null
    - slot_was_set:
      - requested_slot: null
    - action: action_clear_countries
    - action: country_form_II
    - active_loop: country_form_II



#------------END OF CONVERSATION----------------
#  - rule: second thank you
#    condition:
#    - slot_was_set:
#      - regulations_type: local_regulations
#    steps:
#    - intent: thank_you
#    - action: utter_ur_welcome
#    - action: utter_prompt_continue

#  - rule: first thank you
#    condition:
#    - slot_was_set:
#      - query_counter: 1
#      - regulations_type: entry_regulations
#    steps:
#    - intent: thank_you
#    - action: utter_ur_welcome
#    - action: want_local_info_form
#    - active_loop: want_local_info_form
  - rule: ask continue_form after a query
    steps:
    - action: action_query_knowledgebase_cases
    - action: continue_form
    - active_loop: continue_form

  - rule: ask keep details
    condition:
    - active_loop: continue_form
    - slot_was_set:
      - want_to_continue: true
    steps:
    - action: continue_form
    - active_loop: null
    - slot_was_set:
      - requested_slot: null
    - action: keep_details_form
    - active_loop: keep_details_form
    - active_loop: null
    - slot_was_set:
      - requested_slot: null
    - action: validate_keep_context
    wait_for_user_input: false
  - rule: continuation prompt
    steps:
    - action: validate_keep_context
    - action: utter_prompt_continue
  - rule: ask continue_form false
    condition:
    - active_loop: continue_form
    - slot_was_set:
      - want_to_continue: false
    steps:
    - action: continue_form
    - active_loop: null
    - slot_was_set:
      - requested_slot: null
    - action: utter_goodbye

#  - rule: end of convo afetr local info
#    condition:
#    - slot_was_set:
#      - want_localinfo: false
#    steps:
#      - action: want_local_info_form
#      - active_loop: null
#      - slot_was_set:
#        - requested_slot: null
#      - action: utter_prompt_continue
  - rule: don't continue
    steps:
    - action: utter_prompt_continue
    - intent: deny
    - action: utter_goodbye  
  - rule: nothing else
    steps:
    - intent: nothing_else
    - action: utter_goodbye

#------IN BETWEEN QUERIES-----
#- rule: ask keep context
#  condition:
#  - slot_was_set:
#    query_counter: 1
#  steps:
#  - action:

# ----- SECOND QUERY -----
#  - rule: run second query
#    steps:
#    - action: action_query_knowledgebase_cases
#    - intent: query_entry_regulations
#    - action: action_validate_transit
#    wait_for_user_input: false

  - rule: 2nd query
    steps:
    - action: action_validate_transit
    - action: action_query_knowledgebase_cases
  - rule: 2nd query LU+plane
    condition:
    - slot_was_set:
      - plane_travel: true
      - country_to: Luxembourg
    steps:
    - action: action_validate_transit
    - action: transport_health_worker_form
    - active_loop: null
    - action: action_query_knowledgebase_cases




#  - rule: continue convo
#    condition:
#    - slot_was_set:
#      - want_localinfo: true
#    steps:
#      - action: want_local_info_form
#      - active_loop: null
#      - slot_was_set:
#        - requested_slot: null
#      - action: action_query_knowledgebase_cases

#----------FORM INTERRUPTS------
#  - rule: local_rules_form interrupt
#    condition:
#    - active_loop: local_regulations_form
#    - slot_was_set:
#      - requested_slot: indoors/outdoors
#    steps:
#    - intent: nothing_else
#    - action: local_regulations_form
#    - active_loop: null
#    - action: utter_goodbye
#  - rule: country_form interrupt
#    condition:
#    - active_loop: country_form
#    steps:
#    - intent: ask_which_countries
#    - action: utter_list_the_countries
#    - action: country_form
#    - active_loop: country_form
  - rule: regulations_type_form interrupt
    condition:
    - active_loop: regulations_type_form
    steps:
    - intent: nothing_else
    - action: regulations_type_form
    - active_loop: null
    - action: utter_goodbye
  - rule: end continue_form form I
    condition:
    - active_loop: continue_form
    steps:
    - intent: goodbye
    - action: continue_form
    - active_loop: null
    - action: utter_goodbye
  - rule:  end continue_form II
    condition:
    - active_loop: continue_form
    steps:
    - intent: nothing_else
    - action: continue_form
    - active_loop: null
    - action: utter_goodbye
#  - rule: details on test
#    steps:
#    - intent: test_details
#    - action: action_query_knowledgebase_cases



